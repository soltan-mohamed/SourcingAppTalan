<div class="candidates-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <div class="header-icon">
          <span class="material-symbols-outlined">people</span>
        </div>
        <div class="header-text">
          <h1 class="page-title">Candidates List</h1>
          <p class="page-subtitle">Manage and track all candidate applications</p>
        </div>
      </div>
      <div class="header-actions">
        <button 
          (click)="openAddCandidate()" 
          mat-fab 
          color="primary"
          class="add-candidate-btn"
          aria-label="Add candidate">
          <span class="material-symbols-outlined">add</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="candidates-content">
    
    <!-- Compact Search Section -->
    <div class="compact-search-container">
      <form [formGroup]="searchForm">
        <!-- Search and Filters Row -->
        <div class="search-row">
          <!-- General Search Section -->
          <div class="search-section">
            <div class="candidates-input-wrapper">
              <mat-form-field appearance="outline" class="candidates-search-input candidates-custom-input">
                <mat-label>Search candidates...</mat-label>
                <input 
                  matInput 
                  formControlName="searchText"
                  [placeholder]="getCurrentSearchPlaceholder()"
                  [disabled]="isSearching || selectedCriteria.length === 0">
                <span class="material-symbols-outlined candidates-prefix-icon" matPrefix>search</span>
                
                <!-- Search Criteria Filter Button -->
                <button 
                  type="button"
                  matSuffix 
                  mat-icon-button 
                  [matMenuTriggerFor]="criteriaMenu"
                  matTooltip="Select search criteria"
                  class="candidates-criteria-btn candidates-suffix-button">
                  <span class="material-symbols-outlined">tune</span>
                </button>
                
                <!-- Clear search button -->
                <button 
                  type="button"
                  matSuffix 
                  mat-icon-button 
                  *ngIf="getCurrentSearchText()"
                  (click)="clearFormField('searchText')"
                  class="candidates-clear-btn candidates-suffix-button">
                  <span class="material-symbols-outlined">close</span>
                </button>
              </mat-form-field>
            </div>

            <!-- Search Criteria Menu -->
            <mat-menu #criteriaMenu="matMenu" class="search-criteria-menu">
              <div class="criteria-menu-content" (click)="$event.stopPropagation()">
                <!-- Header Section -->
                <div class="criteria-header">
                  <div class="criteria-title">
                    <div>
                      <h4>Search Criteria</h4>
                    </div>
                    <div class="criteria-actions">
                      <button 
                        type="button"
                        (click)="selectAllCriteria()"
                        class="criteria-quick-btn select-all">
                        <span class="material-symbols-outlined">select_all</span>
                        All
                      </button>
                      <button 
                        type="button"
                        (click)="clearAllCriteria()"
                        class="criteria-quick-btn clear-all">
                        <span class="material-symbols-outlined">clear</span>
                        Clear
                      </button>
                    </div>
                  </div>
                </div>
                
                <!-- Criteria Options -->
                <div class="criteria-options">
                  <label *ngFor="let criteria of searchCriteria" 
                         class="criteria-option">
                    <input 
                      type="checkbox"
                      [checked]="isCriteriaSelected(criteria.key)"
                      (change)="toggleSearchCriteria(criteria.key)"
                      class="criteria-checkbox">
                    <div class="criteria-icon">
                      <span class="material-symbols-outlined">{{ criteria.icon }}</span>
                    </div>
                    <span class="criteria-label">{{ criteria.label }}</span>
                    <span class="material-symbols-outlined criteria-check" *ngIf="isCriteriaSelected(criteria.key)">check_circle</span>
                  </label>
                </div>
                
                <!-- Footer Info -->
                <div class="criteria-footer">
                  <div class="criteria-info">
                    <span class="material-symbols-outlined">info</span>
                    <p>Selected: {{ getSelectedCriteriaLabels() || 'None selected' }}</p>
                  </div>
                </div>
              </div>
            </mat-menu>
          </div>

          <!-- Status Filter Section -->
          <div class="filter-section">
            <div class="candidates-select-wrapper">
              <mat-form-field appearance="outline" class="candidates-filter-input candidates-custom-select">
                <mat-label>Status</mat-label>
                <mat-select formControlName="statut" [disabled]="isSearching">
                  <mat-option value="">
                    <div class="candidates-select-option">
                      <span class="material-symbols-outlined">list</span>
                      <span>All Status</span>
                    </div>
                  </mat-option>
                  <mat-option *ngFor="let status of allStatuses" [value]="status">
                    <div class="candidates-select-option candidates-status-option">
                      <span class="candidates-status-indicator"
                            [ngClass]="{
                              'status-accepted': status === 'ACCEPTED',
                              'status-rejected': status === 'REJECTED',
                              'status-scheduled': status === 'SCHEDULED',
                              'status-vivier': status === 'VIVIER',
                              'status-cancelled': status === 'CANCELLED',
                              'status-contacted': status === 'CONTACTED',
                              'status-in-progress': status === 'IN_PROGRESS'
                            }"></span>
                      <span>{{ getStatusDisplayName(status) }}</span>
                      <span class="candidates-status-count">({{ getStatusCount(status) }})</span>
                    </div>
                  </mat-option>
                </mat-select>
                <span class="material-symbols-outlined candidates-prefix-icon" matPrefix>filter_list</span>
              </mat-form-field>
            </div>
          </div>

          <!-- Experience Filter Section -->
          <div class="filter-section">
            <div class="candidates-select-wrapper">
              <mat-form-field appearance="outline" class="candidates-filter-input candidates-custom-select">
                <mat-label>Experience</mat-label>
                <mat-select formControlName="experienceRange" [disabled]="isSearching">
                  <mat-option *ngFor="let range of experienceRanges" [value]="range.label">
                    <div class="candidates-select-option">
                      <span>{{ range.label }}</span>
                    </div>
                  </mat-option>
                </mat-select>
                <span class="material-symbols-outlined candidates-prefix-icon" matPrefix>timeline</span>
              </mat-form-field>
            </div>
          </div>

          <!-- Action Buttons Section -->
          <div class="action-section">
            <button 
              type="button"
              mat-icon-button
              (click)="clearSearch()"
              matTooltip="Clear all filters"
              class="action-btn">
              <span class="material-symbols-outlined">clear</span>
            </button>
            <button 
              type="button"
              mat-icon-button
              (click)="refreshCandidates()"
              matTooltip="Refresh results"
              class="action-btn">
              <span class="material-symbols-outlined">refresh</span>
            </button>
          </div>
        </div>
      </form>

      <!-- Active Filters and Progress Row -->
      <div class="status-row" *ngIf="hasActiveFilters() || isSearching">
        <!-- Active Filters Summary -->
        <div *ngIf="hasActiveFilters()" class="compact-active-filters">
          <span *ngIf="getCurrentSearchText()" class="compact-filter-chip candidates-search-chip">
            <span class="material-symbols-outlined">search</span>
            "{{ getCurrentSearchText() }}"
            <button type="button" (click)="clearFormField('searchText')" class="chip-remove">
              <span class="material-symbols-outlined">close</span>
            </button>
          </span>

          <span *ngIf="getCurrentStatusValue()" class="compact-filter-chip candidates-status-chip">
            <span class="candidates-status-indicator" [class]="getStatusClass(getCurrentStatusValue())"></span>
            {{ getStatusDisplayName(getCurrentStatusValue()) }}
            <button type="button" (click)="clearFormField('statut')" class="chip-remove">
              <span class="material-symbols-outlined">close</span>
            </button>
          </span>

          <span *ngIf="getCurrentExperienceRange()" class="compact-filter-chip candidates-experience-chip">
            <span class="material-symbols-outlined">work</span>
            {{ getCurrentExperienceRange() }}
            <button type="button" (click)="clearFormField('experienceRange')" class="chip-remove">
              <span class="material-symbols-outlined">close</span>
            </button>
          </span>
        </div>

        <!-- Progress Indicator -->
        <div *ngIf="isSearching" class="compact-loading">
          <div class="loading-spinner">
            <svg class="spinner" viewBox="0 0 24 24">
              <circle class="spinner-circle" cx="12" cy="12" r="10"></circle>
              <path class="spinner-path" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
          </div>
          <span>Searching...</span>
        </div>
      </div>
    </div>
    <!-- Results Table Card -->
    <div class="results-card">
      <div class="results-header">
        <div class="results-info">
          <h3 class="results-title">
            {{ candidates.length }} Candidate{{ candidates.length !== 1 ? 's' : '' }}
            <span *ngIf="hasActiveFilters()" class="filtered-label">(filtered)</span>
          </h3>
          
          <!-- Status distribution for current results -->

        </div>
        
        <div class="results-actions">
          <button 
            mat-icon-button
            (click)="refreshCandidates()"
            class="action-btn"
            matTooltip="Refresh">
            <span class="material-symbols-outlined">refresh</span>
          </button>
          <button 
            mat-icon-button
            class="action-btn"
            matTooltip="Export">
            <span class="material-symbols-outlined">download</span>
          </button>
        </div>
      </div>

      <!-- Table Container -->
      <div class="table-container">
        <ng-scrollbar *ngIf="candidates.length !== 0" class="table-scroll" visibility="hover">
          <app-table-card 
            [dataSource]="candidates" 
            [columnDefinitions]="candidateColumnDefinitions"
            (candidateUpdated)="refreshCandidates()"
            [refreshCallback]="refreshCandidates.bind(this)"
            class="candidates-table">
          </app-table-card>
        </ng-scrollbar>

        <!-- Empty State -->
        <div *ngIf="candidates.length === 0" class="empty-state">
          <div class="empty-icon">
            <span class="material-symbols-outlined">people_outline</span>
          </div>
          <h3>No candidates found</h3>
          <p *ngIf="!hasActiveFilters()">Get started by adding your first candidate</p>
          <p *ngIf="hasActiveFilters()">Try adjusting your search criteria</p>
          <button 
            *ngIf="!hasActiveFilters()"
            (click)="openAddCandidate()"
            mat-raised-button 
            color="primary"
            class="empty-action-btn">
            <span class="material-symbols-outlined">add</span>
            Add Candidate
          </button>
          <button 
            *ngIf="hasActiveFilters()"
            (click)="clearSearch()"
            mat-raised-button 
            class="empty-action-btn">
            <span class="material-symbols-outlined">clear</span>
            Clear Filters
          </button>
        </div>
      </div>
    </div>

  </div>
</div>
