<div class="candidates-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <div class="header-icon">
          <span class="material-symbols-outlined">people</span>
        </div>
        <div class="header-text">
          <h1 class="page-title">Vivier Candidates</h1>
          <p class="page-subtitle">Manage and track candidates in the talent pool</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="candidates-content">
    
    <!-- Compact Search and AI Section -->
    <div class="compact-search-container">
      <form [formGroup]="searchForm">
        <!-- Search and Filters Row -->
        <div class="search-row">
        <div class="search-section">
          <div class="vivier-input-wrapper">
            <mat-form-field appearance="outline" class="candidates-search-input vivier-custom-input">
              <mat-label>Search candidates...</mat-label>
              <input 
                matInput 
                formControlName="searchText"
                [placeholder]="getCurrentSearchPlaceholder()"
                [disabled]="isSearching || selectedCriteria.length === 0">
              <span class="material-symbols-outlined vivier-prefix-icon" matPrefix>search</span>
            
            <!-- Search Criteria Filter Button -->
            <button 
              type="button"
              matSuffix 
              [matMenuTriggerFor]="criteriaMenu"
              matTooltip="Select search criteria"
              class="candidates-criteria-btn vivier-suffix-button">
              <span class="material-symbols-outlined">tune</span>
            </button>
            
            <!-- Clear search button -->
            <button 
              type="button"
              matSuffix 
              *ngIf="getCurrentSearchText()"
              (click)="clearFormField('searchText')"
              class="candidates-clear-btn vivier-suffix-button">
              <span class="material-symbols-outlined">close</span>
            </button>
          </mat-form-field>
          </div>

          <!-- Search Criteria Menu -->
          <mat-menu #criteriaMenu="matMenu" class="search-criteria-menu">
            <div class="criteria-menu-content" (click)="$event.stopPropagation()">
              <!-- Header Section -->
              <div class="criteria-header">
                <div class="criteria-title">
                  <div>
                    <h4>Search Criteria</h4>
                  </div>
                  <div class="criteria-actions">
                    <button 
                      type="button"
                      (click)="selectAllCriteria()"
                      class="criteria-quick-btn select-all">
                      <span class="material-symbols-outlined">select_all</span>
                      All
                    </button>
                    <button 
                      type="button"
                      (click)="clearAllCriteria()"
                      class="criteria-quick-btn clear-all">
                      <span class="material-symbols-outlined">clear</span>
                      Clear
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Criteria Options -->
              <div class="criteria-options">
                <label *ngFor="let criteria of searchCriteria" 
                       class="criteria-option"
                       [class.selected]="isCriteriaSelected(criteria.key)">
                  <input 
                    type="checkbox"
                    [checked]="isCriteriaSelected(criteria.key)"
                    (change)="toggleSearchCriteria(criteria.key)"
                    class="criteria-checkbox">
                  <div class="criteria-icon">
                    <span class="material-symbols-outlined">{{ criteria.icon }}</span>
                  </div>
                  <span class="criteria-label">{{ criteria.label }}</span>
                  <span class="material-symbols-outlined criteria-check" *ngIf="isCriteriaSelected(criteria.key)">check_circle</span>
                </label>
              </div>
              
              <!-- Footer Info -->
              <div class="criteria-footer">
                <div class="criteria-info">
                  <span class="material-symbols-outlined">info</span>
                  <p>Selected: {{ getSelectedCriteriaLabels() || 'None selected' }}</p>
                </div>
              </div>
            </div>
          </mat-menu>
        </div>

        <!-- Experience Filter -->
        <div class="filter-section">
          <div class="vivier-select-wrapper">
            <mat-form-field appearance="outline" class="candidates-filter-input vivier-custom-select">
              <mat-label>Experience</mat-label>
              <mat-select formControlName="experienceRange" [disabled]="isSearching">
                <mat-option *ngFor="let range of experienceRanges" [value]="range.label">
                  <div class="candidates-select-option">
                    <span>{{ range.label }}</span>
                  </div>
                </mat-option>
              </mat-select>
              <span class="material-symbols-outlined vivier-prefix-icon" matPrefix>timeline</span>
            </mat-form-field>
          </div>
        </div>

        <!-- AI Search Section -->
        <div class="ai-section">
          <div class="vivier-ai-custom-wrapper">
            <div class="vivier-ai-input-container">
              <span class="material-symbols-outlined vivier-ai-prefix-icon">psychology</span>
              <div class="vivier-ai-input-field">
                <input 
                  type="text" 
                  name="searchQuery"
                  class="vivier-ai-input"
                  [(ngModel)]="searchQuery" 
                  (keyup.enter)="findMatches()"
                  (input)="onAISearchInput($event)"
                  placeholder="AI Skills (e.g., Java, Angular, React)">
              </div>
            </div>
          </div>
          <button 
            type="button"
            class="vivier-raised-button ai-match-btn-compact"
            (click)="findMatches()"
            [disabled]="isMatching || !searchQuery?.trim()">
            <span *ngIf="!isMatching" class="material-symbols-outlined">psychology</span>
            <span *ngIf="isMatching" class="material-symbols-outlined animate-spin">autorenew</span>
            <span *ngIf="!isMatching">AI Match</span>
            <span *ngIf="isMatching">Matching...</span>
          </button>
        </div>

        <!-- Action Buttons -->
        <div class="action-section">
          <!-- Separator -->
          <div class="action-separator"></div>
          
          <button 
            type="button"
            (click)="clearSearch()"
            matTooltip="Clear all filters"
            class="action-btn vivier-icon-button">
            <span class="material-symbols-outlined">clear</span>
          </button>
          <button 
            type="button"
            (click)="refreshCandidates()"
            matTooltip="Refresh results"
            class="action-btn vivier-icon-button">
            <span class="material-symbols-outlined">refresh</span>
          </button>
        </div>
      </div>
      </form>

      <!-- Active Filters and Progress Row -->
      <div class="status-row" *ngIf="hasActiveFilters() || isSearching || isMatching">
        <!-- Active Filters Summary -->
        <div *ngIf="hasActiveFilters()" class="compact-active-filters">
          <span *ngIf="getCurrentSearchText()" class="compact-filter-chip candidates-search-chip">
            <span class="material-symbols-outlined">search</span>
            "{{ getCurrentSearchText() }}"
            <button type="button" (click)="clearFormField('searchText')" class="chip-remove">
              <span class="material-symbols-outlined">close</span>
            </button>
          </span>

          <span *ngIf="getCurrentExperienceRange()" class="compact-filter-chip candidates-experience-chip">
            <span class="material-symbols-outlined">work</span>
            {{ getCurrentExperienceRange() }}
            <button type="button" (click)="clearFormField('experienceRange')" class="chip-remove">
              <span class="material-symbols-outlined">close</span>
            </button>
          </span>

          <span *ngIf="searchQuery" class="compact-filter-chip ai-search-chip">
            <span class="material-symbols-outlined">psychology</span>
            AI: "{{ searchQuery }}"
            <button type="button" (click)="clearAISearch()" class="chip-remove">
              <span class="material-symbols-outlined">close</span>
            </button>
          </span>
        </div>

        <!-- Progress Indicators -->
        <div *ngIf="isSearching" class="compact-loading">
          <div class="loading-spinner">
            <svg class="spinner" viewBox="0 0 24 24">
              <circle class="spinner-circle" cx="12" cy="12" r="10"></circle>
              <path class="spinner-path" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
          </div>
          <span>Searching...</span>
        </div>

        <div *ngIf="isMatching" class="compact-loading ai-loading">
          <div class="loading-spinner">
            <svg class="spinner" viewBox="0 0 24 24">
              <circle class="spinner-circle" cx="12" cy="12" r="10"></circle>
              <path class="spinner-path" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
          </div>
          <span>AI Matching...</span>
        </div>
      </div>
    </div>

    <!-- Results Table Card -->
    <div class="results-card">
      <div class="results-header">
        <div class="results-info">
          <h3 class="results-title">
            {{ filteredCandidates.length }} Vivier Candidate{{ filteredCandidates.length !== 1 ? 's' : '' }}
            <span *ngIf="searchQuery" class="filtered-label">(sorted by relevance)</span>
          </h3>
        </div>
        
        <div class="results-actions">
          <button 
            mat-icon-button
            class="action-btn"
            (click)="downloadPDF()"
            [disabled]="isDownloadingPDF || filteredCandidates.length === 0"
            [matTooltip]="isDownloadingPDF ? 'Generating PDF...' : 'Export to PDF'">
            <span class="material-symbols-outlined" *ngIf="!isDownloadingPDF">picture_as_pdf</span>
            <svg *ngIf="isDownloadingPDF" class="spinner" viewBox="0 0 24 24" width="20" height="20">
              <circle class="spinner-circle" cx="12" cy="12" r="10"></circle>
              <path class="spinner-path" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
          </button>
          <button 
            mat-icon-button
            class="action-btn"
            (click)="downloadExcel()"
            [disabled]="isDownloadingExcel || filteredCandidates.length === 0"
            [matTooltip]="isDownloadingExcel ? 'Generating Excel...' : 'Export to Excel'">
            <span class="material-symbols-outlined" *ngIf="!isDownloadingExcel">table_view</span>
            <svg *ngIf="isDownloadingExcel" class="spinner" viewBox="0 0 24 24" width="20" height="20">
              <circle class="spinner-circle" cx="12" cy="12" r="10"></circle>
              <path class="spinner-path" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
          </button>
        </div>

      </div>

      <!-- Table Container -->
      <div class="table-container">
        <ng-scrollbar *ngIf="filteredCandidates.length !== 0" class="table-scroll" visibility="hover">
          <app-table-card 
            [dataSource]="filteredCandidates" 
            [columnDefinitions]="candidateColumnDefinitions"
            class="candidates-table">
          </app-table-card>
        </ng-scrollbar>

        <!-- Empty State -->
        <div *ngIf="!isRefreshing && filteredCandidates.length === 0" class="empty-state">
          <div class="empty-icon">
            <span class="material-symbols-outlined">people_outline</span>
          </div>
          <h3>No vivier candidates found</h3>
          <p *ngIf="!searchQuery && !hasActiveFilters()">Candidates with VIVIER status will appear here</p>
          <p *ngIf="searchQuery">No matches found for "{{searchQuery}}"</p>
          <p *ngIf="!searchQuery && hasActiveFilters()">Try adjusting your search criteria</p>
          <button 
            *ngIf="hasActiveFilters()"
            (click)="clearSearch()"
            class="vivier-raised-button empty-action-btn">
            <span class="material-symbols-outlined">clear</span>
            Clear Filters
          </button>
        </div>
      </div>
    </div>

  </div>
</div>